---
title: linux 常用命令-文件编辑
date: 2018/02/27
categories:
- linux
tags:
- linux
- command
---

<!-- TOC -->

- [linux 常用命令-文件编辑](#linux-常用命令-文件编辑)
    - [sed](#sed)
        - [补充说明](#补充说明)
        - [sed的选项、命令、替换标记](#sed的选项命令替换标记)
        - [选项](#选项)
        - [参数](#参数)
        - [sed命令](#sed命令)
        - [sed替换标记](#sed替换标记)
        - [sed元字符集](#sed元字符集)
        - [sed用法实例](#sed用法实例)
            - [替换操作：s命令](#替换操作s命令)
            - [全面替换标记g](#全面替换标记g)
            - [定界符](#定界符)
            - [删除操作：d命令](#删除操作d命令)
            - [已匹配字符串标记&](#已匹配字符串标记)
            - [子串匹配标记\1](#子串匹配标记\1)
            - [组合多个表达式](#组合多个表达式)
            - [引用](#引用)
            - [选定行的范围：,（逗号）](#选定行的范围逗号)
            - [多点编辑：e命令](#多点编辑e命令)
            - [从文件读入：r命令](#从文件读入r命令)
            - [写入文件：w命令](#写入文件w命令)
            - [追加（行下）：a\命令](#追加行下a\命令)
            - [插入（行上）：i\命令](#插入行上i\命令)
            - [下一个：n命令](#下一个n命令)
            - [变形：y命令](#变形y命令)
            - [退出：q命令](#退出q命令)
            - [保持和获取：h命令和G命令](#保持和获取h命令和g命令)
            - [保持和互换：h命令和x命令](#保持和互换h命令和x命令)
            - [脚本scriptfile](#脚本scriptfile)
            - [打印奇数行或偶数行](#打印奇数行或偶数行)
            - [打印匹配字符串的下一行](#打印匹配字符串的下一行)
    - [vi](#vi)
        - [补充说明](#补充说明-1)
        - [语法](#语法)
        - [选项](#选项-1)
        - [参数](#参数-1)
        - [知识扩展](#知识扩展)

<!-- /TOC -->

# linux 常用命令-文件编辑

## sed

功能强大的流式文本编辑器

### 补充说明

**sed** 是一种流编辑器，它是文本处理中非常中的工具，能够完美的配合正则表达式使用，功能不同凡响。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。

### sed的选项、命令、替换标记  

 **命令格式** 

```
sed [options] 'command' file(s)
sed [options] -f scriptfile file(s)
```

### 选项  

```
-e<script>或--expression=<script>：以选项中的指定的script来处理输入的文本文件；
-f<script文件>或--file=<script文件>：以选项中指定的script文件来处理输入的文本文件；
-h或--help：显示帮助；
-n或--quiet或——silent：仅显示script处理后的结果；
-V或--version：显示版本信息。
```

### 参数  

文件：指定待处理的文本文件列表。

### sed命令  

```
 **a\**  在当前行下面插入文本。
 **i\**  在当前行上面插入文本。
 **c\**  把选定的行改为新的文本。
 **d**  删除，删除选择的行。
 **D**  删除模板块的第一行。
 **s**  替换指定字符
 **h**  拷贝模板块的内容到内存中的缓冲区。
 **H**  追加模板块的内容到内存中的缓冲区。
 **g**  获得内存缓冲区的内容，并替代当前模板块中的文本。
 **G**  获得内存缓冲区的内容，并追加到当前模板块文本的后面。
 **l**  列表不能打印字符的清单。
 **n**  读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。
 **N**  追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。
 **p**  打印模板块的行。
 **P** (大写) 打印模板块的第一行。
 **q**  退出Sed。
 **b lable**  分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。
 **r file**  从file中读行。
 **t label**  if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
 **T label**  错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
 **w file**  写并追加模板块到file末尾。  
 **W file**  写并追加模板块的第一行到file末尾。  
 **!**  表示后面的命令对所有没有被选定的行发生作用。  
 **=**  打印当前行号码。  
 **#**  把注释扩展到下一个换行符以前。  
```

### sed替换标记  

```
 **g**  表示行内全面替换。  
 **p**  表示打印行。  
 **w**  表示把行写入一个文件。  
 **x**  表示互换模板块中的文本和缓冲区中的文本。  
 **y**  表示把一个字符翻译为另外的字符（但是不用于正则表达式）
 **\1**  子串匹配标记
 **&**  已匹配字符串标记
```

### sed元字符集  

```
 **^**  匹配行开始，如：/^sed/匹配所有以sed开头的行。
 **$**  匹配行结束，如：/sed$/匹配所有以sed结尾的行。
 **.**  匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。
 **** * 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。
 **[]**  匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。  
 **[^]**  匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。
 **\(..\)**  匹配子串，保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers。
 **&**  保存搜索字符用来替换其他字符，如s/love/ **&** /，love这成 **love** 。
 **\<**  匹配单词的开始，如:/\<love/匹配包含以love开头的单词的行。
 **\>**  匹配单词的结束，如/love\>/匹配包含以love结尾的单词的行。
 **x\{m\}**  重复字符x，m次，如：/0\{5\}/匹配包含5个0的行。
 **x\{m,\}**  重复字符x，至少m次，如：/0\{5,\}/匹配至少有5个0的行。
 **x\{m,n\}**  重复字符x，至少m次，不多于n次，如：/0\{5,10\}/匹配5~10个0的行。  
```

### sed用法实例  

#### 替换操作：s命令  

替换文本中的字符串：

```
sed 's/book/books/' file
```

 **-n选项** 和 **p命令** 一起使用表示只打印那些发生替换的行：

sed -n 's/test/TEST/p' file

直接编辑文件 **选项-i** ，会匹配file文件中每一行的第一个book替换为books：

```
sed -i 's/book/books/g' file
```

#### 全面替换标记g  

使用后缀 /g 标记会替换每一行中的所有匹配：

```
sed 's/book/books/g' file
```

当需要从第N处匹配开始替换时，可以使用 /Ng：

```
echo sksksksksksk | sed 's/sk/SK/2g'
skSKSKSKSKSK

echo sksksksksksk | sed 's/sk/SK/3g'
skskSKSKSKSK

echo sksksksksksk | sed 's/sk/SK/4g'
skskskSKSKSK
```

#### 定界符  

以上命令中字符 / 在sed中作为定界符使用，也可以使用任意的定界符：

```
sed 's:test:TEXT:g'
sed 's|test|TEXT|g'
```

定界符出现在样式内部时，需要进行转义：

```
sed 's/\/bin/\/usr\/local\/bin/g'
```

#### 删除操作：d命令  

删除空白行：

```
sed '/^$/d' file
```

删除文件的第2行：

```
sed '2d' file
```

删除文件的第2行到末尾所有行：

```
sed '2,$d' file
```

删除文件最后一行：

```
sed '$d' file
```

删除文件中所有开头是test的行：

```
sed '/^test/'d file
```

#### 已匹配字符串标记&  

正则表达式 \w\+ 匹配每一个单词，使用 [&] 替换它，& 对应于之前所匹配到的单词：

```
echo this is a test line | sed 's/\w\+/[&]/g'
[this] [is] [a] [test] [line]
```

所有以192.168.0.1开头的行都会被替换成它自已加localhost：

```
sed 's/^192.168.0.1/&localhost/' file
192.168.0.1localhost
```

#### 子串匹配标记\1  

匹配给定样式的其中一部分：

```
echo this is digit 7 in a number | sed 's/digit \([0-9]\)/\1/'
this is 7 in a number
```

命令中 digit 7，被替换成了 7。样式匹配到的子串是 7，\(..\) 用于匹配子串，对于匹配到的第一个子串就标记为  **\1** ，依此类推匹配到的第二个结果就是  **\2** ，例如：

```
echo aaa BBB | sed 's/\([a-z]\+\) \([A-Z]\+\)/\2 \1/'
BBB aaa
```

love被标记为1，所有loveable会被替换成lovers，并打印出来：

```
sed -n 's/\(love\)able/\1rs/p' file
```

#### 组合多个表达式  

```
sed '表达式' | sed '表达式'

等价于：

sed '表达式; 表达式'
```

#### 引用  

sed表达式可以使用单引号来引用，但是如果表达式内部包含变量字符串，就需要使用双引号。

```
test=hello
echo hello WORLD | sed "s/$test/HELLO"
HELLO WORLD
```

#### 选定行的范围：,（逗号）  

所有在模板test和check所确定的范围内的行都被打印：

```
sed -n '/test/,/check/p' file
```

打印从第5行开始到第一个包含以test开始的行之间的所有行：

```
sed -n '5,/^test/p' file
```

对于模板test和west之间的行，每行的末尾用字符串aaa bbb替换：

```
sed '/test/,/west/s/$/aaa bbb/' file
```

#### 多点编辑：e命令  

-e选项允许在同一行里执行多条命令：

```
sed -e '1,5d' -e 's/test/check/' file
```

上面sed表达式的第一条命令删除1至5行，第二条命令用check替换test。命令的执行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。

和 -e 等价的命令是 --expression：

```
sed --expression='s/test/check/' --expression='/love/d' file
```

#### 从文件读入：r命令  

file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面：

```
sed '/test/r file' filename
```

#### 写入文件：w命令    

在example中所有包含test的行都被写入file里：

```
sed -n '/test/w file' example
```

#### 追加（行下）：a\命令  

将 this is a test line 追加到 以test 开头的行后面：

```
sed '/^test/a\this is a test line' file
```

在 test.conf 文件第2行之后插入 this is a test line：

```
sed -i '2a\this is a test line' test.conf
```

#### 插入（行上）：i\命令  

将 this is a test line 追加到以test开头的行前面：

```
sed '/^test/i\this is a test line' file
```

在test.conf文件第5行之前插入this is a test line：

```
sed -i '5i\this is a test line' test.conf
```

#### 下一个：n命令  

如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续：

```
sed '/test/{ n; s/aa/bb/; }' file
```

#### 变形：y命令  

把1~10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令：

```
sed '1,10y/abcde/ABCDE/' file
```

#### 退出：q命令  

打印完第10行后，退出sed

```
sed '10q' file
```

#### 保持和获取：h命令和G命令  

在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。

```
sed -e '/test/h' -e '$G' file
```

在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。

#### 保持和互换：h命令和x命令  

互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换：

```
sed -e '/test/h' -e '/check/x' file
```

#### 脚本scriptfile  

sed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。

```
sed [options] -f scriptfile file(s)
```

#### 打印奇数行或偶数行  

方法1：

```
sed -n 'p;n' test.txt  #奇数行
sed -n 'n;p' test.txt  #偶数行

```

方法2：

```
sed -n '1~2p' test.txt  #奇数行
sed -n '2~2p' test.txt  #偶数行

```

#### 打印匹配字符串的下一行  

```
grep -A 1 SCC URFILE
sed -n '/SCC/{n;p}' URFILE
awk '/SCC/{getline; print}' URFILE

```

## vi

功能强大的纯文本编辑器

### 补充说明

**vi命令** 是UNIX操作系统和类UNIX操作系统中最通用的全屏幕纯文本编辑器。Linux中的vi编辑器叫vim，它是vi的增强版（vi Improved），与vi编辑器完全兼容，而且实现了很多增强功能。

vi编辑器支持编辑模式和命令模式，编辑模式下可以完成文本的编辑功能，命令模式下可以完成对文件的操作命令，要正确使用vi编辑器就必须熟练掌握着两种模式的切换。默认情况下，打开vi编辑器后自动进入命令模式。从编辑模式切换到命令模式使用“esc”键，从命令模式切换到编辑模式使用“A”、“a”、“O”、“o”、“I”、“i”键。

vi编辑器提供了丰富的内置命令，有些内置命令使用键盘组合键即可完成，有些内置命令则需要以冒号“：”开头输入。常用内置命令如下：

```
Ctrl+u：向文件首翻半屏；
Ctrl+d：向文件尾翻半屏；
Ctrl+f：向文件尾翻一屏；
Ctrl+b：向文件首翻一屏；
Esc：从编辑模式切换到命令模式；
ZZ：命令模式下保存当前文件所做的修改后退出vi；
:行号：光标跳转到指定行的行首；
:$：光标跳转到最后一行的行首；
x或X：删除一个字符，x删除光标后的，而X删除光标前的；
D：删除从当前光标到光标所在行尾的全部字符；
dd：删除光标行正行内容；
ndd：删除当前行及其后n-1行；
nyy：将当前行及其下n行的内容保存到寄存器？中，其中？为一个字母，n为一个数字；
p：粘贴文本操作，用于将缓存区的内容粘贴到当前光标所在位置的下方；
P：粘贴文本操作，用于将缓存区的内容粘贴到当前光标所在位置的上方；
/字符串：文本查找操作，用于从当前光标所在位置开始向文件尾部查找指定字符串的内容，查找的字符串会被加亮显示；
？name：文本查找操作，用于从当前光标所在位置开始向文件头部查找指定字符串的内容，查找的字符串会被加亮显示；
a，bs/F/T：替换文本操作，用于在第a行到第b行之间，将F字符串换成T字符串。其中，“s/”表示进行替换操作；
a：在当前字符后添加文本；
A：在行末添加文本；
i：在当前字符前插入文本；
I：在行首插入文本；
o：在当前行后面插入一空行；
O：在当前行前面插入一空行；
:wq：在命令模式下，执行存盘退出操作；
:w：在命令模式下，执行存盘操作；
:w！：在命令模式下，执行强制存盘操作；
:q：在命令模式下，执行退出vi操作；
:q！：在命令模式下，执行强制退出vi操作；
:e文件名：在命令模式下，打开并编辑指定名称的文件；
:n：在命令模式下，如果同时打开多个文件，则继续编辑下一个文件；
:f：在命令模式下，用于显示当前的文件名、光标所在行的行号以及显示比例；
:set number：在命令模式下，用于在最左端显示行号；
:set nonumber：在命令模式下，用于在最左端不显示行号；
```

### 语法  

```
vi(选项)(参数)
```

### 选项  

```
+<行号>：从指定行号的行开始先是文本内容；
-b：以二进制模式打开文件，用于编辑二进制文件和可执行文件；
-c<指令>：在完成对第一个文件编辑任务后，执行给出的指令；
-d：以diff模式打开文件，当多个文件编辑时，显示文件差异部分；
-l：使用lisp模式，打开“lisp”和“showmatch”；
-m：取消写文件功能，重设“write”选项；
-M：关闭修改功能；
-n：不实用缓存功能；
-o<文件数目>：指定同时打开指定数目的文件；
-R：以只读方式打开文件；
-s：安静模式，不现实指令的任何错误信息。
```

### 参数  

文件列表：指定要编辑的文件列表。多个文件之间使用空格分隔开。

### 知识扩展  

vi编辑器有三种工作方式：命令方式、输入方式和ex转义方式。通过相应的命令或操作，在这三种工作方式之间可以进行转换。

 **命令方式** 

在Shell提示符后输入命令vi，进入vi编辑器，并处于vi的命令方式。此时，从键盘上输入的任何字符都被作为编辑命令来解释，例如，a(append）表示附加命令，i(insert）表示插入命令，x表示删除字符命令等。如果输入的字符不是vi的合法命令，则机器发出“报警声”，光标不移动。另外，在命令方式下输入的字符（即vi命令）并不在屏幕上显示出来，例如，输入i，屏幕上并无变化，但通过执行i命令，编辑器的工作方式却发生变化：由命令方式变为输入方式。

 **输入方式** 

通过输入vi的插入命令（i）、附加命令（a）、打开命令（o）、替换命令（s）、修改命令(c）或取代命令（r）可以从命令方式进入输入方式。在输入方式下，从键盘上输入的所有字符都被插入到正在编辑的缓冲区中，被当做该文件的正文。进入输入方式后，输入的可见字符都在屏幕上显示出来，而编辑命令不再起作用，仅作为普通字母出现。例如，在命令方式下输入字母i，进到输入方式，然后再输入i，就在屏幕上相应光标处添加一个字母i。

由输入方式回到命令方式的办法是按下Esc键。如果已在命令方式下，那么按下Esc键就会发出“嘟嘟”声。为了确保用户想执行的vi命令是在命令方式下输入的，不妨多按几下Esc键，听到嘟声后再输入命令。

 **ex转义方式** 

vi和ex编辑器的功能是相同的，二者的主要区别是用户界面。在vi中，命令通常是单个字母，如a,x,r等。而在ex中，命令是以Enter；键结束的命令行。vi有一个专门的“转义”命令，可访问很多面向行的ex命令。为使用ex转义方式，可输入一个冒号（:）。作为ex命令提示符，冒号出现在状态行（通常在屏幕最下一行）。按下中断键（通常是Del键），可终止正在执行的命令。多数文件管理命令都是在ex转义方式下执行的（例如，读取文件，把编辑缓冲区的内容写到文件中等）。转义命令执行后，自动回到命令方式。例如：

```
:1,$s/I/i/g 按Enter键
```

则从文件第一行至文件末尾（$）将大写I全部替换成小写i。vi编辑器的三种工作方式之间的转换如图所示。

![vi.jpg](http://man.linuxde.net/wp-content/uploads/2013/11/vi.jpg)
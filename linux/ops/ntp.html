<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ—¶é—´æœåŠ¡å™¨ - NTP | LINUX-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/linux-tutorial/favicon.ico">
    <meta name="description" content="æ•°æ®åº“æ•™ç¨‹">
    <link rel="preload" href="/linux-tutorial/assets/css/0.styles.ad9dfdff.css" as="style"><link rel="preload" href="/linux-tutorial/assets/js/app.6ef400fc.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/4.f08b9687.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/43.a90cd32f.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/5.0833ef28.js" as="script"><link rel="prefetch" href="/linux-tutorial/assets/js/10.21a8834a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/11.e7792e7f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/12.ba1d049e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/13.09bcd1b4.js"><link rel="prefetch" href="/linux-tutorial/assets/js/14.b7e006af.js"><link rel="prefetch" href="/linux-tutorial/assets/js/15.55aa59c1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/16.2868d8f7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/17.2e2294c1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/18.98a9b7c7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/19.836f374a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/20.c65bd63b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/21.c419a85b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/22.3990c487.js"><link rel="prefetch" href="/linux-tutorial/assets/js/23.965d12d7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/24.59042e2c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/25.91fa61bd.js"><link rel="prefetch" href="/linux-tutorial/assets/js/26.caead015.js"><link rel="prefetch" href="/linux-tutorial/assets/js/27.de47c13c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/28.b970bd70.js"><link rel="prefetch" href="/linux-tutorial/assets/js/29.d339dcce.js"><link rel="prefetch" href="/linux-tutorial/assets/js/30.ab8033c9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/31.df963552.js"><link rel="prefetch" href="/linux-tutorial/assets/js/32.7156ff0f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/33.7d91da37.js"><link rel="prefetch" href="/linux-tutorial/assets/js/34.6136a817.js"><link rel="prefetch" href="/linux-tutorial/assets/js/35.1ead2af6.js"><link rel="prefetch" href="/linux-tutorial/assets/js/36.46c19b61.js"><link rel="prefetch" href="/linux-tutorial/assets/js/37.057781fd.js"><link rel="prefetch" href="/linux-tutorial/assets/js/38.9e2a1632.js"><link rel="prefetch" href="/linux-tutorial/assets/js/39.296b8d76.js"><link rel="prefetch" href="/linux-tutorial/assets/js/40.0950f5e9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/41.6c9bb432.js"><link rel="prefetch" href="/linux-tutorial/assets/js/42.32e50e96.js"><link rel="prefetch" href="/linux-tutorial/assets/js/44.d3fcafca.js"><link rel="prefetch" href="/linux-tutorial/assets/js/45.156cea1e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/46.0ce54651.js"><link rel="prefetch" href="/linux-tutorial/assets/js/47.8cbbacee.js"><link rel="prefetch" href="/linux-tutorial/assets/js/48.213a2cf7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/49.53277437.js"><link rel="prefetch" href="/linux-tutorial/assets/js/50.2ce5c4ff.js"><link rel="prefetch" href="/linux-tutorial/assets/js/51.7d4084a6.js"><link rel="prefetch" href="/linux-tutorial/assets/js/52.41d9aa37.js"><link rel="prefetch" href="/linux-tutorial/assets/js/53.8a5576ce.js"><link rel="prefetch" href="/linux-tutorial/assets/js/54.63fb3052.js"><link rel="prefetch" href="/linux-tutorial/assets/js/55.d7a55877.js"><link rel="prefetch" href="/linux-tutorial/assets/js/56.8c4c419c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/57.12aae846.js"><link rel="prefetch" href="/linux-tutorial/assets/js/58.755dd350.js"><link rel="prefetch" href="/linux-tutorial/assets/js/59.a66f9cf5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/6.713ad725.js"><link rel="prefetch" href="/linux-tutorial/assets/js/60.8abf5883.js"><link rel="prefetch" href="/linux-tutorial/assets/js/61.633e0f57.js"><link rel="prefetch" href="/linux-tutorial/assets/js/62.ab662585.js"><link rel="prefetch" href="/linux-tutorial/assets/js/63.c6a71d34.js"><link rel="prefetch" href="/linux-tutorial/assets/js/64.d1632d35.js"><link rel="prefetch" href="/linux-tutorial/assets/js/65.6e5c8506.js"><link rel="prefetch" href="/linux-tutorial/assets/js/66.e4b0067b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/67.b210233b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/68.590348c3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/69.197e73fe.js"><link rel="prefetch" href="/linux-tutorial/assets/js/7.a10910a7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/70.43c8f35c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/8.04e2e190.js"><link rel="prefetch" href="/linux-tutorial/assets/js/9.cccc2c89.js"><link rel="prefetch" href="/linux-tutorial/assets/js/vendors~flowchart.d81c2c68.js"><link rel="prefetch" href="/linux-tutorial/assets/js/vendors~notification.4573acaf.js">
    <link rel="stylesheet" href="/linux-tutorial/assets/css/0.styles.ad9dfdff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/linux-tutorial/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="LINUX-TUTORIAL" class="logo"> <span class="site-name can-hide">LINUX-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/linux-tutorial/linux/cli/" class="nav-link">
  Linux å‘½ä»¤
</a></div><div class="nav-item"><a href="/linux-tutorial/linux/ops/" class="nav-link router-link-active">
  Linux è¿ç»´
</a></div><div class="nav-item"><a href="/linux-tutorial/linux/soft/" class="nav-link">
  Linux è½¯ä»¶è¿ç»´
</a></div><div class="nav-item"><a href="/linux-tutorial/docker/" class="nav-link">
  Docker æ•™ç¨‹
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/linux-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/linux-tutorial/linux/cli/" class="nav-link">
  Linux å‘½ä»¤
</a></div><div class="nav-item"><a href="/linux-tutorial/linux/ops/" class="nav-link router-link-active">
  Linux è¿ç»´
</a></div><div class="nav-item"><a href="/linux-tutorial/linux/soft/" class="nav-link">
  Linux è½¯ä»¶è¿ç»´
</a></div><div class="nav-item"><a href="/linux-tutorial/docker/" class="nav-link">
  Docker æ•™ç¨‹
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/linux-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>æ—¶é—´æœåŠ¡å™¨ - NTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/linux-tutorial/linux/ops/ntp.html#ä¸€ã€ntp-ç®€ä»‹" class="sidebar-link">ä¸€ã€NTP ç®€ä»‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/linux-tutorial/linux/ops/ntp.html#äºŒã€ntpd-æœåŠ¡" class="sidebar-link">äºŒã€ntpd æœåŠ¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#yum-å®‰è£…" class="sidebar-link">yum å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#ntpd-é…ç½®" class="sidebar-link">ntpd é…ç½®</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#æ”¾å¼€é˜²ç«å¢™é™åˆ¶" class="sidebar-link">æ”¾å¼€é˜²ç«å¢™é™åˆ¶</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#ntpd-æœåŠ¡å‘½ä»¤" class="sidebar-link">ntpd æœåŠ¡å‘½ä»¤</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#æŸ¥çœ‹-ntp-æœåŠ¡çŠ¶æ€" class="sidebar-link">æŸ¥çœ‹ ntp æœåŠ¡çŠ¶æ€</a></li></ul></li><li><a href="/linux-tutorial/linux/ops/ntp.html#ä¸‰ã€ntpdate-å‘½ä»¤" class="sidebar-link">ä¸‰ã€ntpdate å‘½ä»¤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#æ‰‹åŠ¨æ‰§è¡Œæ—¶é—´åŒæ­¥" class="sidebar-link">æ‰‹åŠ¨æ‰§è¡Œæ—¶é—´åŒæ­¥</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/linux/ops/ntp.html#è‡ªåŠ¨å®šæ—¶åŒæ­¥æ—¶é—´" class="sidebar-link">è‡ªåŠ¨å®šæ—¶åŒæ­¥æ—¶é—´</a></li></ul></li><li><a href="/linux-tutorial/linux/ops/ntp.html#å››ã€å›½å†…-ntp-æœåŠ¡å™¨" class="sidebar-link">å››ã€å›½å†… NTP æœåŠ¡å™¨</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/linux-tutorial/linux/ops/ntp.html#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="æ—¶é—´æœåŠ¡å™¨-ntp"><a href="#æ—¶é—´æœåŠ¡å™¨-ntp" class="header-anchor">#</a> æ—¶é—´æœåŠ¡å™¨ - NTP</h1> <h2 id="ä¸€ã€ntp-ç®€ä»‹"><a href="#ä¸€ã€ntp-ç®€ä»‹" class="header-anchor">#</a> ä¸€ã€NTP ç®€ä»‹</h2> <p>ç½‘ç»œæ—¶é—´åè®®ï¼ˆè‹±è¯­ï¼šNetwork Time Protocolï¼Œç¼©å†™ï¼šNTPï¼‰æ˜¯åœ¨æ•°æ®ç½‘ç»œæ½œä¼æ—¶é—´å¯å˜çš„è®¡ç®—æœºç³»ç»Ÿä¹‹é—´é€šè¿‡åˆ†ç»„äº¤æ¢è¿›è¡Œæ—¶é’ŸåŒæ­¥çš„ä¸€ä¸ªç½‘ç»œåè®®ï¼Œä½äº OSI æ¨¡å‹çš„åº”ç”¨å±‚ã€‚è‡ª 1985 å¹´ä»¥æ¥ï¼ŒNTP æ˜¯ç›®å‰ä»åœ¨ä½¿ç”¨çš„æœ€å¤è€çš„äº’è”ç½‘åè®®ä¹‹ä¸€ã€‚NTP ç”±ç‰¹æ‹‰åå¤§å­¦çš„ David L. Millsï¼ˆè‹±è¯­ï¼šDavid L. Millsï¼‰è®¾è®¡ã€‚</p> <p><strong>NTP æ„å›¾å°†æ‰€æœ‰å‚ä¸è®¡ç®—æœºçš„åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰æ—¶é—´åŒæ­¥åˆ°å‡ æ¯«ç§’çš„è¯¯å·®å†…</strong>ã€‚</p> <p>NTP è¦ç‚¹ï¼š</p> <ul><li>åœ°çƒå…±æœ‰ 24 ä¸ªæ—¶åŒºï¼Œè€Œä»¥æ ¼æ—å¨æ²»æ—¶é—´ (GMT) ä¸ºæ ‡å‡†æ—¶é—´ï¼›</li> <li>ä¸­å›½æœ¬åœ°æ—¶é—´ä¸º GMT +8 å°æ—¶ï¼›</li> <li>æœ€å‡†ç¡®çš„æ—¶é—´ä¸ºä½¿ç”¨åŸå­é’Ÿ (Atomic clock) æ‰€è®¡ç®—çš„ï¼Œä¾‹å¦‚ UTC (Coordinated Universal Time) å°±æ˜¯ä¸€ä¾‹ï¼›</li> <li>Linux ç³»ç»Ÿæœ¬æ¥å°±æœ‰ä¸¤ç§æ—¶é—´ï¼Œä¸€ç§æ˜¯ Linux ä»¥ <code>1970/01/01</code> å¼€å§‹è®¡æ•°çš„ç³»ç»Ÿæ—¶é—´ï¼Œä¸€ç§åˆ™æ˜¯ BIOS è®°è½½çš„ç¡¬ä»¶æ—¶é—´ï¼›</li> <li>Linux å¯ä»¥é€è¿‡ç½‘ç»œæ ¡æ—¶ï¼Œæœ€å¸¸è§çš„ç½‘ç»œæ ¡æ—¶ä¸ºä½¿ç”¨ NTP æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å¯åŠ¨åœ¨ <code>udp port 123</code>ï¼›</li> <li>æ—¶åŒºæ¡£æ¡ˆä¸»è¦æ”¾ç½®äº <code>/usr/share/zoneinfo/</code> ç›®å½•ä¸‹ï¼Œè€Œæœ¬åœ°æ—¶åŒºåˆ™å‚è€ƒ <code>/etc/localtime</code>ï¼›</li> <li>NTP æœåŠ¡å™¨ä¸ºä¸€ç§é˜¶å±‚å¼çš„æœåŠ¡ï¼Œæ‰€ä»¥ NTP æœåŠ¡å™¨æœ¬æ¥å°±ä¼šä¸ä¸Šå±‚æ—¶é—´æœåŠ¡å™¨ä½œæ—¶é—´çš„åŒæ­¥åŒ–ï¼Œ å› æ­¤ <code>nptd</code> ä¸ <code>ntpdate</code> ä¸¤ä¸ªæŒ‡ä»¤ä¸å¯åŒæ—¶ä½¿ç”¨ï¼›</li> <li>NTP æœåŠ¡å™¨çš„è”æœºçŠ¶æ€å¯ä»¥ä½¿ç”¨ <code>ntpstat</code> åŠ <code>ntpq -p</code> æ¥æŸ¥è¯¢ï¼›</li> <li>NTP æä¾›çš„å®¢æˆ·ç«¯è½¯ä»¶ä¸º <code>ntpdate</code> è¿™ä¸ªæŒ‡ä»¤ï¼›</li> <li>åœ¨ Linux ä¸‹æƒ³è¦æ‰‹åŠ¨å¤„ç†æ—¶é—´æ—¶ï¼Œéœ€ä»¥ <code>date</code> è®¾å®šæ—¶é—´åï¼Œä»¥ <code>hwclock -w</code> æ¥å†™å…¥ BIOS æ‰€è®°å½•çš„æ—¶é—´ã€‚</li> <li>NTP æœåŠ¡å™¨ä¹‹é—´çš„æ—¶é—´è¯¯å·®ä¸å¯è¶…è¿‡ 1000 ç§’ï¼Œå¦åˆ™ NTP æœåŠ¡ä¼šè‡ªåŠ¨å…³é—­ã€‚</li></ul> <blockquote><p>æ›´å¤š NTP è¯¦æƒ…å¯ä»¥å‚è€ƒï¼š<a href="http://cn.linux.vbird.org/linux_server/0440ntp.php" target="_blank" rel="noopener noreferrer">é¸Ÿå“¥çš„ Linux ç§æˆ¿èœ-- NTP æ—¶é—´æœåŠ¡å™¨<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="äºŒã€ntpd-æœåŠ¡"><a href="#äºŒã€ntpd-æœåŠ¡" class="header-anchor">#</a> äºŒã€ntpd æœåŠ¡</h2> <blockquote><p>ç¯å¢ƒï¼šCentOS</p></blockquote> <h3 id="yum-å®‰è£…"><a href="#yum-å®‰è£…" class="header-anchor">#</a> yum å®‰è£…</h3> <p>CentOS å®‰è£… NTP å¾ˆç®€å•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum -y <span class="token function">install</span> ntp
</code></pre></div><h3 id="ntpd-é…ç½®"><a href="#ntpd-é…ç½®" class="header-anchor">#</a> ntpd é…ç½®</h3> <p>ntp çš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸ºï¼š <code>/etc/ntp.conf</code> ï¼Œå‚è€ƒé…ç½®ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 1. å…ˆå¤„ç†æƒé™æ–¹é¢çš„é—®é¢˜ï¼ŒåŒ…æ‹¬æ”¾è¡Œä¸Šå±‚æœåŠ¡å™¨ä»¥åŠå¼€æ”¾åŒºç½‘ç”¨æˆ·æ¥æºï¼š</span>
<span class="token comment"># restrict default kod nomodify notrap nopeer noquery     # æ‹’ç» IPv4 çš„ç”¨æˆ·</span>
<span class="token comment"># restrict -6 default kod nomodify notrap nopeer noquery  # æ‹’ç» IPv6 çš„ç”¨æˆ·</span>
restrict default nomodify notrap nopeer noquery
<span class="token comment">#restrict 192.168.100.0 mask 255.255.255.0 nomodify # æ”¾è¡ŒåŒå±€åŸŸç½‘æ¥æºï¼ˆæ ¹æ®ç½‘å…³å’Œå­ç½‘æ©ç å†³å®šï¼‰</span>
restrict <span class="token number">127.0</span>.0.1   <span class="token comment"># é»˜è®¤å€¼ï¼Œæ”¾è¡Œæœ¬æœº IPv4 æ¥æº</span>
restrict ::1         <span class="token comment"># é»˜è®¤å€¼ï¼Œæ”¾è¡Œæœ¬æœº IPv6 æ¥æº</span>

<span class="token comment"># 2. è®¾å®š NTP ä¸»æœºæ¥æº</span>
<span class="token comment"># æ³¨é‡Šæ‰é»˜è®¤ NTP æ¥æº</span>
<span class="token comment"># server 0.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 1.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 2.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 3.centos.pool.ntp.org iburst</span>
<span class="token comment"># è®¾ç½®å›½å†… NTP æ¥æº</span>
server cn.pool.ntp.org prefer <span class="token comment"># ä»¥è¿™ä¸ªä¸»æœºä¸ºä¼˜å…ˆ</span>
server ntp1.aliyun.com
server ntp.sjtu.edu.cn

<span class="token comment"># 3. é¢„è®¾æ—¶é—´å·®å¼‚åˆ†ææ¡£æ¡ˆä¸æš‚ä¸ç”¨åˆ°çš„ keys ç­‰ï¼Œä¸éœ€è¦æ›´æ”¹å®ƒï¼š</span>
driftfile /var/lib/ntp/drift
keys /etc/ntp/keys
includefile /etc/ntp/crypto/pw
</code></pre></div><blockquote><p>æ³¨æ„ï¼šå¦‚æœæ›´æ”¹é…ç½®ï¼Œå¿…é¡»é‡å¯ NTP æœåŠ¡ï¼ˆ<code>systemctl restart ntpd</code>ï¼‰æ‰èƒ½ç”Ÿæ•ˆã€‚</p></blockquote> <h3 id="æ”¾å¼€é˜²ç«å¢™é™åˆ¶"><a href="#æ”¾å¼€é˜²ç«å¢™é™åˆ¶" class="header-anchor">#</a> æ”¾å¼€é˜²ç«å¢™é™åˆ¶</h3> <p>NTP æœåŠ¡çš„ç«¯å£æ˜¯ <code>123</code>ï¼Œä½¿ç”¨çš„æ˜¯ udp åè®®ï¼Œæ‰€ä»¥ NTP æœåŠ¡å™¨çš„é˜²ç«å¢™å¿…é¡»å¯¹å¤–å¼€æ”¾ udp 123 è¿™ä¸ªç«¯å£ã€‚</p> <p>å¦‚æœé˜²ç«å¢™ä½¿ç”¨ <strong><code>iptables</code></strong>ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>iptables -A INPUT -p UDP -i eth0 -s <span class="token number">192.168</span>.0.0/24 --dport <span class="token number">123</span> -j ACCEPT
</code></pre></div><p>å¦‚æœé˜²ç«å¢™ä½¿ç”¨ <strong><code>firewalld</code></strong>ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">123</span>/udp --permanent
</code></pre></div><h3 id="ntpd-æœåŠ¡å‘½ä»¤"><a href="#ntpd-æœåŠ¡å‘½ä»¤" class="header-anchor">#</a> ntpd æœåŠ¡å‘½ä»¤</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> ntpd.service  <span class="token comment"># å¼€å¯æœåŠ¡ï¼ˆå¼€æœºè‡ªåŠ¨å¯åŠ¨æœåŠ¡ï¼‰</span>
systemctl disable ntpd.service <span class="token comment"># å…³é—­æœåŠ¡ï¼ˆå¼€æœºä¸ä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡ï¼‰</span>
systemctl start ntpd.service   <span class="token comment"># å¯åŠ¨æœåŠ¡</span>
systemctl stop ntpd.service    <span class="token comment"># åœæ­¢æœåŠ¡</span>
systemctl restart ntpd.service <span class="token comment"># é‡å¯æœåŠ¡</span>
systemctl reload ntpd.service  <span class="token comment"># é‡æ–°è½½å…¥é…ç½®</span>
systemctl status ntpd.service  <span class="token comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
</code></pre></div><h3 id="æŸ¥çœ‹-ntp-æœåŠ¡çŠ¶æ€"><a href="#æŸ¥çœ‹-ntp-æœåŠ¡çŠ¶æ€" class="header-anchor">#</a> æŸ¥çœ‹ ntp æœåŠ¡çŠ¶æ€</h3> <h4 id="éªŒè¯-ntp-æœåŠ¡æ­£å¸¸å·¥ä½œ"><a href="#éªŒè¯-ntp-æœåŠ¡æ­£å¸¸å·¥ä½œ" class="header-anchor">#</a> éªŒè¯ NTP æœåŠ¡æ­£å¸¸å·¥ä½œ</h4> <p>æ‰§è¡Œ <code>ntpstat</code> å¯ä»¥æŸ¥çœ‹ ntp æœåŠ¡å™¨æœ‰æ— å’Œä¸Šå±‚ ntp è¿é€šï¼Œï¼Œå¦‚æœæˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ntpstat
synchronised to NTP server <span class="token punctuation">(</span><span class="token number">5.79</span>.108.34<span class="token punctuation">)</span> at stratum <span class="token number">3</span>
   <span class="token function">time</span> correct to within <span class="token number">1129</span> ms
   polling server every <span class="token number">64</span> s
</code></pre></div><h4 id="æŸ¥çœ‹-ntp-æœåŠ¡å™¨ä¸ä¸Šå±‚-ntp-çš„çŠ¶æ€"><a href="#æŸ¥çœ‹-ntp-æœåŠ¡å™¨ä¸ä¸Šå±‚-ntp-çš„çŠ¶æ€" class="header-anchor">#</a> æŸ¥çœ‹ ntp æœåŠ¡å™¨ä¸ä¸Šå±‚ ntp çš„çŠ¶æ€</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
*ntp1.ams1.nl.le <span class="token number">130.133</span>.1.10     <span class="token number">2</span> u   <span class="token number">36</span>   <span class="token number">64</span>  <span class="token number">367</span>  <span class="token number">230.801</span>    <span class="token number">5.271</span>   <span class="token number">2.791</span>
 <span class="token number">120.25</span>.115.20   <span class="token number">10.137</span>.53.7      <span class="token number">2</span> u   <span class="token number">33</span>   <span class="token number">64</span>  <span class="token number">377</span>   <span class="token number">25.930</span>   <span class="token number">15.908</span>   <span class="token number">3.168</span>
 time.cloudflare <span class="token number">10.21</span>.8.251      <span class="token number">3</span> u   <span class="token number">31</span>   <span class="token number">64</span>  <span class="token number">367</span>  <span class="token number">251.109</span>   <span class="token number">16.976</span>   <span class="token number">3.264</span>
</code></pre></div><h2 id="ä¸‰ã€ntpdate-å‘½ä»¤"><a href="#ä¸‰ã€ntpdate-å‘½ä»¤" class="header-anchor">#</a> ä¸‰ã€ntpdate å‘½ä»¤</h2> <blockquote><p>æ³¨æ„ï¼šNTP æœåŠ¡å™¨ä¸ºä¸€ç§é˜¶å±‚å¼çš„æœåŠ¡ï¼Œæ‰€ä»¥ NTP æœåŠ¡å™¨æœ¬æ¥å°±ä¼šä¸ä¸Šå±‚æ—¶é—´æœåŠ¡å™¨ä½œæ—¶é—´çš„åŒæ­¥åŒ–ï¼Œ å› æ­¤ <code>nptd</code> ä¸ <code>ntpdate</code> ä¸¤ä¸ªæŒ‡ä»¤ä¸å¯åŒæ—¶ä½¿ç”¨ã€‚</p></blockquote> <h3 id="æ‰‹åŠ¨æ‰§è¡Œæ—¶é—´åŒæ­¥"><a href="#æ‰‹åŠ¨æ‰§è¡Œæ—¶é—´åŒæ­¥" class="header-anchor">#</a> æ‰‹åŠ¨æ‰§è¡Œæ—¶é—´åŒæ­¥</h3> <p><code>ntpdate</code> å‘½ä»¤æ˜¯ NTP çš„å®¢æˆ·ç«¯è½¯ä»¶ï¼Œå®ƒå¯ä»¥ç”¨äºè¯·æ±‚æ—¶é—´åŒæ­¥ã€‚</p> <p>è¯­æ³•ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>/usr/sbin/ntpdate <span class="token operator">&lt;</span>ntp_server<span class="token operator">&gt;</span>
</code></pre></div><p><code>ntp_server</code> å¯ä»¥ä» [å›½å†… NTP æœåŠ¡å™¨](#å›½å†… NTP æœåŠ¡å™¨) ä¸­é€‰æ‹©ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ntpdate cn.pool.ntp.org
<span class="token number">11</span> Feb <span class="token number">10</span>:47:12 ntpdate<span class="token punctuation">[</span><span class="token number">30423</span><span class="token punctuation">]</span>: step <span class="token function">time</span> server <span class="token number">84.16</span>.73.33 offset -49.894774 sec
</code></pre></div><h3 id="è‡ªåŠ¨å®šæ—¶åŒæ­¥æ—¶é—´"><a href="#è‡ªåŠ¨å®šæ—¶åŒæ­¥æ—¶é—´" class="header-anchor">#</a> è‡ªåŠ¨å®šæ—¶åŒæ­¥æ—¶é—´</h3> <p>å¦‚æœéœ€è¦è‡ªåŠ¨å®šæ—¶åŒæ­¥æ—¶é—´ï¼Œå¯ä»¥åˆ©ç”¨ <a href="#crontab">Crontab</a> å·¥å…·ã€‚æœ¬è´¨å°±æ˜¯ç”¨ crontab å®šæ—¶æ‰§è¡Œä¸€æ¬¡æ‰‹åŠ¨æ—¶é—´åŒæ­¥å‘½ä»¤ ntpã€‚</p> <p>ç¤ºä¾‹ï¼šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥åœ¨æ¯å¤©å‡Œæ™¨ 3 ç‚¹åŒæ­¥ç³»ç»Ÿæ—¶é—´ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;0 3 * * * /usr/sbin/ntpdate cn.pool.ntp.org&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/crontab <span class="token comment"># ä¿®æ”¹ crond æœåŠ¡é…ç½®</span>
systemctl restart crond <span class="token comment"># é‡å¯ crond æœåŠ¡ä»¥ç”Ÿæ•ˆ</span>
</code></pre></div><h2 id="å››ã€å›½å†…-ntp-æœåŠ¡å™¨"><a href="#å››ã€å›½å†…-ntp-æœåŠ¡å™¨" class="header-anchor">#</a> å››ã€å›½å†… NTP æœåŠ¡å™¨</h2> <p>ä»¥ä¸‹ NTP æœåŠ¡å™¨æœé›†è‡ªç½‘ç»œï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>cn.pool.ntp.org  <span class="token comment"># æœ€å¸¸ç”¨çš„å›½å†…NTPæœåŠ¡å™¨ï¼Œå‚è€ƒï¼šhttps://www.ntppool.org/zh/use.html</span>
cn.ntp.org.cn    <span class="token comment"># ä¸­å›½</span>
edu.ntp.org.cn   <span class="token comment"># ä¸­å›½æ•™è‚²ç½‘</span>
ntp1.aliyun.com  <span class="token comment"># é˜¿é‡Œäº‘</span>
ntp2.aliyun.com  <span class="token comment"># é˜¿é‡Œäº‘</span>
ntp.sjtu.edu.cn  <span class="token comment"># ä¸Šæµ·äº¤é€šå¤§å­¦</span>
s1a.time.edu.cn  <span class="token comment"># åŒ—äº¬é‚®ç”µå¤§å­¦</span>
s1b.time.edu.cn  <span class="token comment"># æ¸…åå¤§å­¦</span>
s1c.time.edu.cn  <span class="token comment"># åŒ—äº¬å¤§å­¦</span>
s1d.time.edu.cn  <span class="token comment"># ä¸œå—å¤§å­¦</span>
s1e.time.edu.cn  <span class="token comment"># æ¸…åå¤§å­¦</span>
s2a.time.edu.cn  <span class="token comment"># æ¸…åå¤§å­¦</span>
s2b.time.edu.cn  <span class="token comment"># æ¸…åå¤§å­¦</span>
s2c.time.edu.cn  <span class="token comment"># åŒ—äº¬é‚®ç”µå¤§å­¦</span>
s2d.time.edu.cn  <span class="token comment"># è¥¿å—åœ°åŒºç½‘ç»œä¸­å¿ƒ</span>
s2e.time.edu.cn  <span class="token comment"># è¥¿åŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒ</span>
s2f.time.edu.cn  <span class="token comment"># ä¸œåŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒ</span>
s2g.time.edu.cn  <span class="token comment"># åä¸œå—åœ°åŒºç½‘ç»œä¸­å¿ƒ</span>
s2h.time.edu.cn  <span class="token comment"># å››å·å¤§å­¦ç½‘ç»œç®¡ç†ä¸­å¿ƒ</span>
s2j.time.edu.cn  <span class="token comment"># å¤§è¿ç†å·¥å¤§å­¦ç½‘ç»œä¸­å¿ƒ</span>
s2k.time.edu.cn  <span class="token comment"># CERNETæ¡‚æ—ä¸»èŠ‚ç‚¹</span>
</code></pre></div><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li><a href="http://cn.linux.vbird.org/linux_server/0440ntp.php" target="_blank" rel="noopener noreferrer">é¸Ÿå“¥çš„ Linux ç§æˆ¿èœ-- NTP æ—¶é—´æœåŠ¡å™¨<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/quchunhui/p/7658853.html" target="_blank" rel="noopener noreferrer">Linux é…ç½® ntp æ—¶é—´æœåŠ¡å™¨<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/linux-tutorial/edit/master/linux/ops/ntp.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/linux-tutorial/assets/js/app.6ef400fc.js" defer></script><script src="/linux-tutorial/assets/js/4.f08b9687.js" defer></script><script src="/linux-tutorial/assets/js/43.a90cd32f.js" defer></script><script src="/linux-tutorial/assets/js/5.0833ef28.js" defer></script>
  </body>
</html>
